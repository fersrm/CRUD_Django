{% extends "ProyecBazarApp/base.html" %}
{% load static %}
{% block head %}
  <div class="barra_busqueda">
    <span class="text">Tienda</span>
    {% include 'ProyecBazarApp/include/buscador.html' %}
    <button id="abrir-modal" class="Add_produc" onclick="abrir_modal_creacion('{% url 'agregar_prodcuto' %}')">Agregar</button>
  </div>
{% endblock %}

{% block content %}

  <div class="container">
    {% if object_list %}
    <table>
      <thead>
        <tr>
          <th>Imagen</th>
          <th>Codigo</th>
          <th>Nombre de producto</th>
          <th>Categoria</th>
          <th>Marca</th>
          <th>Precio</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for producto in object_list %}
        <tr>
          <td class="tdImg"><img src="{{producto.imagen.url}}" alt="{{producto.nombre_producto}}"></td>
          <td>{{producto.codigo_producto}}</td>
          <td>{{producto.categoria_FK}}</td>
          <td>{{producto.nombre_producto}}</td>
          <td>{{producto.marca_FK}}</td>
          <td>$ {{producto.precio_producto}}</td>
          <td>
            <div class="tdAcciones">
              <button onclick="abrir_modal_edicion('{% url 'editar_producto' producto.id_producto %}')" >Editar</button>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% include 'ProyecBazarApp/include/paginador.html' %}

    <div id="agregar-producto" class="modal"></div>

    <div id="edicion" class="modalEditar"></div>

  {% else %}
  <strong>NO HAY REGISTROS</strong>  
  {% endif %}
  </div>
{%endblock %}

{% block script %}
  <script src="{% static 'ProyecBazarApp/js/modal.js' %}"></script>
  
  <script type="text/javascript">
    function abrir_modal_edicion(url){
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("edicion").innerHTML = this.responseText;
          document.getElementById("edicion").style.display = "block";
        }
      };
      xhttp.open("GET", url, true);
      xhttp.send();
    }

    function abrir_modal_creacion(url){
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("agregar-producto").innerHTML = this.responseText;
          document.getElementById("agregar-producto").style.display = "block";
        }
      };
      xhttp.open("GET", url, true);
      xhttp.send();
    }

  </script>
{% endblock %}
